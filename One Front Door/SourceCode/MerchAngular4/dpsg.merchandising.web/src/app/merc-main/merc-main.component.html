
<!--browser version start  -->



    <div class="container-fluid dispatch-container">

        <!--ribbon  -->
        <div class="row distpatch-menu-row navbar-fixed-top">

            <div class="container-fluid">

                <div class="col-md-5 pull-left">

                    <div class="lable-report">Schedule Date:</div>
                    <div class="float-left">
                    <ng2-datepicker  [(ngModel)]="DispathchDate" (ngModelChange)="onChange($event)" [options]="customScheduleDate" class="merchandiser" ></ng2-datepicker>
                    </div>
                </div>
                <div class="col-md-3 text-center unassigned-store">
                    <div>
                        <span class="unassigned-store" (click)="toggleUnassigned();">Unassigned Stores</span>
                        <span class="badge unassigned-store-badge" (click)="toggleUnassigned();">{{unassignedAcctsLength}}</span>
                    </div>
                </div>

                <div class="col-md-4 text-right">

                    <a class="disp-history" (click)="dispatchHistory()">Schedule History</a>
                    <button class="btn  schedule-bordercolor" style="margin-right:20px;" (click)="resetFromPlanning();" [disabled]="enableReset">Reset</button>
                    
                    <button class="btn  schedule-bordercolor" (click)="openDispatchpopup();" *ngIf="(scheduleDateCount==0)" [disabled]="enableDispatch">Schedule</button>
                    <button class="btn  schedule-bordercolor" (click)="openDispatchpopup();" *ngIf="(scheduleDateCount>0)"  [disabled]="enableDispatch">Re-schedule</button>
                
                    <div class="pull-right" style="margin-left: 15px;" [hidden]="msgText.length > 0">
                            <a (click)="loadData()" class="refresh-btn-a">
                                <img src="/assets/img/Refresh-BTN.png" height="34">
                            </a>
                        </div>
                </div>

            </div>
        </div>
         
        


        <div class="dispatch-row">
            <div [class]="statusCSS">
                <div class="status-detail">  {{scheduleStatusText}}  <span style="font-weight:500;font-style:italic">{{gmtDate | date :'medium'}} {{gmtTime}} </span></div>
            </div>
            <div class="row">
                <div class="col-md-3 unassigned-group-list" *ngIf="unassignedToggle">
                    <a (click)="false;" class="list-group-item" *ngFor="let acct of unassignedAccts">
                        <h4 class="list-group-item-heading">{{acct.AccountName}}</h4>
                        <p class="list-group-item-text">{{acct.Address}}, {{acct.City}}, {{acct.State}}-{{acct.PostalCode}}</p>
                    </a>
                </div>
                <div [class]="unassignedToggle? 'col-md-9' : 'col-md-12'">
                    <div [class]="statusCSS=='status-main-noshow'? 'col-md-6 col-xs-12 col-sm-6 top-padding25' : 'col-md-4 col-xs-12 col-sm-6 top-padding55'" *ngFor="let route of dispatch">
                        <app-route [dispatchDateInput]="dispathchDate" [lastModifiedByInput]="lastModifiedBy" [routeData]="route" 
                        (routeReassigned)="setupdatedroute($event)" (accountSelected)="setselectedAcct($event)" (resequence)="setResequence($event)"></app-route>
                    </div>

                </div>
            </div>
        </div>

    </div>



    <div bsModal #lgModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="false" [config]="{backdrop: 'static'}">
        <div class="modal-dialog  modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" (click)="lgModal.hide()" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                    <h4 class="modal-title text-center">Schedule Status</h4>
                </div>
                <div class="modal-body cusFont" style="min-height:500px; color:#333;over">

                    <table class="table" style="color:#333333" *ngIf="dispatchReadyInfoLength>0">
                        <thead>
                            <tr>
                                <th>Schedule Type</th>
                                <th>GSN</th>
                                <th>Name</th>
                                <th>Route ID</th>
                                <th>Route Name</th>
                                <th>Sequence</th>
                                <th>Account Name</th>
                                <th>Change Notes</th>

                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let dispready of dispatchReadyInfo">
                                <td>{{dispready.DispatchType}}</td>
                                <td>{{dispready.GSN}}</td>
                                <td>{{dispready.FirstName}} {{dispready.LastName}}</td>
                                <td>{{dispready.RouteID}}</td>
                                <td>{{dispready.RouteName}}</td>
                                <td>{{dispready.Sequence}}</td>
                                <td>{{dispready.AccountName}}</td>
                                <td>{{dispready.ChangeNote}}</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="8" class="text-right"> <a class="btn btn-primary" (click)="lgModal.hide();dispatchFinalModal.show();">Schedule</a>
                                    <a class="btn btn-default" (click)="lgModal.hide()">Close</a></td>
                            </tr>
                        </tfoot>
                    </table>
                    <table class="table" style="color:#333" *ngIf="dispatchReadyInfoLength<=0">
                        <thead>
                            <th class="text-center"><span>No changes found from the Last Schedule! </span></th>
                        </thead>
                        <tbody>
                            <tr>
                                <td>&nbsp;</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td class="text-right">
                                    <a class="btn btn-default" (click)="lgModal.hide()">Close</a></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

            </div>
        </div>

    </div>

    <div class="modal fade" bsModal #dispatchFinalModal="bs-modal" [config]="{backdrop: 'static'}" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="false">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" aria-label="Close" (click)="dispatchFinalModal.hide()">
          <span aria-hidden="true">&times;</span>
        </button>
                    <h4 class="modal-title text-center">Schedule</h4>
                </div>
                <!--<div class="modal-body" *ngIf="dispatchReadyInfoLength>0">-->
                <div class="modal-body">
                    <div class="form-group">
                        <label for="comment">Schedule Note:</label>
                        <textarea class="form-control" rows="5" id="comment" (keyup)="onKey($event)" maxlength="199"></textarea>
                    </div>
                    <div class="form-group">
                        <a class="btn  schedule-bordercolor" (click)="finalDispatch();">Schedule</a>
                        <a class="btn  schedule-bordercolor" (click)="dispatchFinalModal.hide();">Close</a>
                    </div>
                </div>
                <!--<div class="modal-body" *ngIf="dispatchReadyInfoLength<=0">
                    <div class="form-group">
                        <label for="comment">No changes found from the Last Schedule!</label>
                    </div>
                    <div class="form-group">
                        <a class="btn btn-default" (click)="dispatchFinalModal.hide();">Close</a>
                    </div>
                </div>-->
            </div>
        </div>
    </div>


    <div bsModal #lgDispatchHistoryModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="merchDispatchHistoryModal" aria-hidden="false" [config]="{backdrop: 'static'}">
        <div class="modal-dialog  modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" (click)="lgDispatchHistoryModal.hide()" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                    <h4 class="modal-title text-center">Schedule History</h4>
                </div>

                <div class="modal-body cusFont" style="min-height:500px; color:#333;over">
                    <table class="table" style="color:#333333" *ngIf="dispHistoryLength>0">
                        <thead>
                            <tr>
                                <th>Schedule Date</th>
                                <th>Schedule By</th>
                                <th>Schedule Notes</th>
                            </tr>
                        </thead>
                        <tbody>


                            <tr *ngFor="let history of dispHistory">
                                <td>{{formatToLocalTime(history.ReleaseTime) | date :'medium'}} {{getTimeZoneName(history.ReleaseTime)}}</td>
                                <td>{{history.FirstName}} {{history.LastName}}</td>
                                <td>{{history.BatchNote}}</td>
                            </tr>
                        </tbody>
                    </table>

                    <table class="table" style="color:#333" *ngIf="dispHistoryLength<=0">
                        <thead>
                            <th class="text-center"><span>No Schedule Found!</span></th>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>

 <div bsModal #unassignedStoresModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="unassignedStores" aria-hidden="false">
        <div class="modal-dialog  modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" (click)="unassignedStoresModal.hide()" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                    <h4 class="modal-title text-center">Unassigned Stores</h4>
                </div>
                <div class="modal-body cusFont" style="min-height:500px; color:#333">
                    <div class="col-xs-12 zeropadding">
                        <table class="table" style="color:#333">
                            <thead>
                                <tr>
                                    <th>
                                        <div class="input-group col-xs-12">
                                            <span class="input-group-addon dispatch-search-addon">
                                                <i class="fa fa-search"></i>
                                            </span>
                                            <input type="text" #filterInput [(ngModel)]="filterText" class="form-control menu-input" id="txtSearch" placeholder="Search">
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let acct of unassignedAccts | filter: { AccountName: filterInput.value, Address: filterInput.value }" 
                                    (click)="setUnassignedAcctSelection(acct.SAPAccountNumber, acct.AccountName, acct.Address, acct.City, acct.State, acct.PostalCode)">
                                    <td><p style="font-size:medium;margin:0px">{{acct.AccountName}}</p>
                                    <p style="font-size:small;margin:0px">{{acct.Address}}, {{acct.City}}, {{acct.State}}-{{acct.PostalCode}} (#{{acct.SAPAccountNumber}})</p></td>
                                    
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>
<div bsModal #unassignedStoreRouteModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="unassignedStoreRouteModal" aria-hidden="false" [config]="{backdrop: 'static'}">
    <div class="modal-dialog  modal-md">
        <div class="modal-content">
            <div class="modal-header" >
                <button type="button" class="close" (click)="unassignedStoreRouteModal.hide()" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title text-center">Assign Route</h4>
            </div>
            <div class="modal-body cusFont text-left" style="min-height:500px">
                
                
                    <div class="form-group">
                        <h4 class="modal-title">Store: <span style="color:#333; margin-left:25px">{{unassignedSelectAcctName}}</span></h4>
                        <h6  style="margin-left: 52px;margin-top:0px"><span style="color:#333; margin-left:25px">{{unassignedSelectAcctAddess}}</span></h6>
                    </div>
                    
                 <div class="col-xs-12 zeropadding">
                    <table class="table" style="color:#333">
                        <thead>
                            <tr>
                                <th>
                                    <div class="input-group col-xs-12">
                                        <!--<span class="input-group-addon dispatch-search-addon">
                                            <i class="fa fa-search"></i>
                                        </span>
                                        <input type="text" #filterInputRoute
                                        class="form-control menu-input" id="txtSearchRoute" placeholder="Search" >-->
                                        <h4 class="modal-title">Select a Route</h4>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let route of dispatchNoEmptyMerch" 
                                (click)="addUnassignedStore(route.RouteID, route.RouteName, route.GSN)">
                                <td>{{route.RouteName}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
            </div>

        </div>
    </div>

</div>
    <div class="row dispatch-row-msg text-center" [hidden]="msgText.length == 0">
        <h2>{{msgText}} </h2>
    </div>

<app-spinner [isRunning]="isRequesting"></app-spinner>