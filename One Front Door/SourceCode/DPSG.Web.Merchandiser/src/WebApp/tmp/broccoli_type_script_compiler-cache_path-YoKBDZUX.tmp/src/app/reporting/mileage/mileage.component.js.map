{"version":3,"file":"mileage.component.js","sourceRoot":"","sources":["mileage.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, Input, ViewEncapsulation } from '@angular/core';\nimport {FORM_DIRECTIVES} from '@angular/common';\nimport {bootstrap}     from '@angular/platform-browser-dynamic';\nimport { DispserviceService } from '../../services/dispservice.service';\nimport {MileageInput, Mileage, UserMerchGroupInput, UserMerchGroup} from './mileageclass';\nimport {SearchPipe} from \"ng2-easy-table/app/pipes/header-pipe\";\nimport {PaginationPipe} from \"ng2-easy-table/app/pipes/pagination-pipe\";\nimport {GlobalSearchPipe} from \"ng2-easy-table/app/pipes/global-search-pipe\";\nimport {FiltersService} from \"ng2-easy-table/app/services/filters-service\";\nimport {ConfigService} from \"ng2-easy-table/app/services/config-service\";\nimport {ResourceService} from \"ng2-easy-table/app/services/resource-service\";\nimport {GlobalSearch} from \"ng2-easy-table/app/components/global-search/global-search.component\";\nimport {CsvExport} from \"ng2-easy-table/app/components/dropdown/csv-export.component\";\nimport {Header} from \"ng2-easy-table/app/components/header/header.component\";\nimport {Pagination} from \"ng2-easy-table/app/components/pagination/pagination.component\";\nimport {DatePicker} from 'ng2-datepicker/ng2-datepicker';\nimport {ChangeNamePipe} from '../StoreService/NamePipe';\nimport {MerchConstant} from '../../../app/MerchAppConstant';\nimport {MultiselectDropdown, IMultiSelectOption, IMultiSelectSettings, IMultiSelectTexts} from '../StoreService/multiselect-dropdown';\nimport {Subscription} from 'rxjs/Subscription';\nimport { HeadernavService } from '../../services/headernav.service';\nimport {MerchGroup} from '../../services/planning';\nimport { SpinnerComponent } from '../../common/spinner';\n\n\n@Component({\n    moduleId: module.id,\n    selector: 'app-mileage',\n    templateUrl: 'mileage.component.html',\n    styleUrls: ['mileage.component.css'],\n    directives: [Header, Pagination, GlobalSearch, CsvExport, DatePicker, FORM_DIRECTIVES, MultiselectDropdown, SpinnerComponent],\n    providers: [FiltersService, ResourceService, ConfigService, DispserviceService, HeadernavService],\n    pipes: [SearchPipe, PaginationPipe, GlobalSearchPipe, ChangeNamePipe]\n\n})\nexport class MileageComponent implements OnInit {\n\n    private _webapi: string = MerchConstant.WebAPI_ENDPOINT;\n\n    item: MerchGroup = new MerchGroup();\n    subscription: Subscription;\n    public isRequesting: boolean;\n    public mileInput: MileageInput;\n    public usrGeo: UserMerchGroupInput;\n    public usrAllGeo: UserMerchGroup;\n    public reportdata: Array<Mileage>;\n    public keys: Array<any>;\n    public numberOfItems: number;\n    public FromDate: string;\n    public ToDate: string;\n    public selectedGeo: Array<any> = [];\n    public showNoDataMessage: Boolean = false;\n\n\n\n    private mySettings: IMultiSelectSettings = {\n        pullRight: false,\n        enableSearch: false,\n        checkedStyle: 'checkboxes',\n        buttonClasses: 'btn btn-default',\n        selectionLimit: 5,\n        closeOnSelect: false,\n        showCheckAll: false,\n        showUncheckAll: false,\n        dynamicTitleMaxItems: 0,\n        maxHeight: '300px',\n    };\n\n    private myTexts: IMultiSelectTexts = {\n        checkAll: 'Check all',\n        uncheckAll: 'Uncheck all',\n        checked: 'checked',\n        checkedPlural: 'checked',\n        searchPlaceholder: 'Search...',\n        defaultTitle: 'Select Groups',\n    };\n\n\n    constructor(\n        public filtersService: FiltersService,\n        public config: ConfigService,\n        public resource: ResourceService,\n        public dispService: DispserviceService,\n        public navService: HeadernavService\n    ) {\n        this.numberOfItems = 1;\n        this.config.rows = 25;\n    }\n\n\n    ngOnInit() {\n        // Set previous week from and to date\n        var curr = new Date; // get current date\n\n        var firstday = new Date(curr.setDate(curr.getDate() - curr.getDay() - 7));\n        var lastday = new Date(curr.setDate(curr.getDate() - curr.getDay() + 6));\n\n        this.FromDate = firstday.toISOString().split('T')[0];\n        this.ToDate = lastday.toISOString().split('T')[0];\n        this.subscription = this.navService.navItem$\n            .subscribe(item => {\n                this.item = item;\n                if (this.item.MerchGroupID) {\n                    this.getMerchGroups(this.item);\n                    this.selectedGeo = [];\n                    this.selectedGeo[0] = this.item.MerchGroupID;\n                    this.loadData();\n                }\n            }\n            );\n    }\n\n    optionsUpdated($event) {\n        this.selectedGeo = $event;\n    }\n\n    getMerchGroups(itemMerchGroup: MerchGroup): void {\n        this.dispService.set(this._webapi + 'api/Merc/GetUserMerchGroups/');\n        this.usrGeo = new UserMerchGroupInput(itemMerchGroup.LoggedInUser);\n        this.getUserMerchGroups(this.usrGeo);\n    }\n\n    getUserMerchGroups(inputdata: UserMerchGroupInput) {\n        this.dispService.post(JSON.stringify(inputdata), true)\n            .subscribe(res => {\n                var d: any = res;\n                this.usrAllGeo = d.UserMerchGroups;\n            },\n            error => {\n                if (error.status == 401 || error.status == 404) {\n                }\n            });\n    }\n\n    loadData(): void {\n\n        this.dispService.set(this._webapi + 'api/Merc/GetMileageReport/');\n        this.mileInput = new MileageInput(this.selectedGeo.join(','), new Date(this.FromDate), new Date(this.ToDate));\n        this.getAllStoreReport(this.mileInput);\n    }\n\n    private stopRefreshing() {\n        this.isRequesting = false;\n    }\n\n    getAllStoreReport(inputdata: MileageInput) {\n        this.isRequesting = true;\n        this.dispService.post(JSON.stringify(inputdata), true)\n            .subscribe(res => {\n                var d: any = res;\n                this.reportdata = d.Mileages;\n                this.numberOfItems = d.Mileages.length;\n                if (d.Mileages.length > 0) {\n                    this.showNoDataMessage = false;\n                    this.keys = Object.keys(d.Mileages[0]);\n                    this.resource.keys = this.keys;\n                }\n                else {\n                    this.showNoDataMessage = true;\n                }\n\n            },\n            () => this.stopRefreshing(),\n            () => this.stopRefreshing()\n            );\n    }\n\n    FilterReportData() {\n\n        if (this.ToDate < this.FromDate) {\n            alert(\"To Date cannot be less than From Date.\");\n            return;\n        }\n        else if (this.selectedGeo.length <= 0) {\n            alert(\"Please select Geo.\");\n            return;\n        }\n        else if (this.days_between(this.ToDate, this.FromDate) > 31) {\n            alert(\"Date range cannot exceed 31 days.\")\n            return;\n        }\n\n        this.mileInput = new MileageInput(this.selectedGeo.join(','), new Date(this.FromDate), new Date(this.ToDate));\n        this.getAllStoreReport(this.mileInput);\n    }\n\n    public orderBy(key: string) {\n        this.reportdata = this.resource.sortBy(key);\n    }\n\n    public parseDate(input) {\n        var parts = input.match(/(\\d+)/g);\n        return new Date(parts[0], parts[1] - 1, parts[2]); // months are 0-based\n    }\n\n\n    public days_between(date1, date2) {\n\n        // The number of milliseconds in one day\n        var ONE_DAY = 1000 * 60 * 60 * 24\n\n        var d1 = this.parseDate(date1);\n        var d2 = this.parseDate(date2);\n\n        // Convert both dates to milliseconds\n        var date1_ms = d1.getTime();\n        var date2_ms = d2.getTime();\n\n        // Calculate the difference in milliseconds\n        var difference_ms = Math.abs(date1_ms - date2_ms);\n\n        // Convert back to days and return\n        return Math.round(difference_ms / ONE_DAY);\n    }\n\n}\n"]}