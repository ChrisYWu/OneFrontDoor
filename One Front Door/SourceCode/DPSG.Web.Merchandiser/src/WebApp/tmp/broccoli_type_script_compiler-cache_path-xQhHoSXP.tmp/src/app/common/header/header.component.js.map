{"version":3,"file":"header.component.js","sourceRoot":"","sources":["header.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, ElementRef } from '@angular/core';\nimport { Http, Headers, Response, RequestOptions } from '@angular/http';\nimport { ROUTER_DIRECTIVES } from '@angular/router';\nimport { DROPDOWN_DIRECTIVES } from 'ng2-bootstrap/ng2-bootstrap';\nimport {LocalStorageService} from 'ng2-webstorage';\nimport {Idle, DEFAULT_INTERRUPTSOURCES} from 'ng2-idle/core';\nimport {MerchConstant} from '../../../app/MerchAppConstant';\nimport {MerchBranch, MerchGroup} from '../../services/planning';\nimport {HeadernavService} from '../../services/headernav.service';\nimport {Subscription} from 'rxjs/Subscription';\n\n// import { TopMenuComponent }   from '../menu/top-menu';\n// import { TopSubMenuComponent }   from '../menu/top-sub-menu';\n// import { UserDropdownComponent }   from '../menu/user-dropdown';\n\n@Component({\n  moduleId: module.id,\n  selector: 'app-header',\n  templateUrl: 'header.component.html',\n  styleUrls: ['header.component.css'],\n  directives: [ROUTER_DIRECTIVES, DROPDOWN_DIRECTIVES],\n  providers: [HeadernavService]\n})\nexport class HeaderComponent implements OnInit {\n\n  private _webapi: string = MerchConstant.WebAPI_ENDPOINT;\n  public userName: string;\n  public merchBranches: Array<MerchBranch>;\n  public merchGroups: Array<MerchGroup> = [];\n  public merchTargetGroups: Array<MerchGroup>;\n  public nobranch: boolean = false;\n  public nomerchgroup: boolean = false;\n  public selectedBranchID: string;\n\n  public menushowreport: boolean = false;\n  public menushowplanning: boolean = false;\n  public selectedBranch: MerchBranch;\n  public selectedGroup: MerchGroup;\n  public item: MerchGroup = new MerchGroup();\n  public merchitem: MerchGroup = new MerchGroup();\n  subscription: Subscription;\n  public isGeoVisible: boolean = true;\n\n\n  public disabled: boolean = false;\n  public status: { isopen: boolean } = { isopen: false };\n  public items: Array<string> = ['The first choice!',\n    'And another choice for you.', 'but wait! A third!'];\n\n  public toggled(open: boolean): void {\n    console.log('Dropdown is now: ', open);\n  }\n\n  public toggleDropdown($event: MouseEvent): void {\n    $event.preventDefault();\n    $event.stopPropagation();\n    this.status.isopen = !this.status.isopen;\n  }\n\n\n  constructor(public http: Http, public localSt: LocalStorageService, public idle: Idle, private navService: HeadernavService) {\n    idle.setIdle(1200);\n    idle.setTimeout(5);\n    idle.setInterrupts(DEFAULT_INTERRUPTSOURCES);\n\n\n    idle.onTimeout.subscribe(() => {\n      console.log('Timeout');\n      window.location.href = \"/logout.html\";\n    });\n\n    idle.watch();\n  }\n\n  ngOnInit() {\n\n    this.selectedBranch = new MerchBranch();\n    this.selectedGroup = new MerchGroup();\n    this.checkUserAuth();\n\n\n    this.subscription = this.navService.navMerchItem$.subscribe(newitem => { this.merchitem = newitem; this.addMerchItem(newitem); });\n  }\n\n  addMerchItem(merchitem) {\n    this.merchitem = merchitem;\n    if (this.merchitem.MerchGroupID != undefined) {\n      this.merchGroups.push(this.merchitem);\n      this.filterMerchGroups(merchitem.SAPBranchID);\n    }\n\n\n  }\n\n  hideGeo(flag: number) {\n    if (flag == 1)\n      this.isGeoVisible = false;\n    else\n      this.isGeoVisible = true;\n  }\n\n  onBranchSelect(branch) {\n    this.selectedBranch = branch;\n    this.filterMerchGroups(branch.SAPBranchID);\n    this.selectedGroup.LoggedInUser = this.localSt.retrieve(\"UserGSN\");\n    this.navService.changeNav(this.selectedGroup);\n  }\n  onGroupSelect(group) {\n    this.selectedGroup = group;\n    this.item = this.selectedGroup;\n    this.item.LoggedInUser = this.localSt.retrieve(\"UserGSN\");\n    this.navService.changeNav(this.item);\n  }\n\n  filterMerchGroups(sapBranchID: string) {\n    this.merchTargetGroups = this.merchGroups.filter((d: any) => {\n      if (d.SAPBranchID == sapBranchID)\n        return d;\n    });\n    var grp = this.merchTargetGroups.filter((d: any) => {\n      if (d.IsDefault == true)\n        return d;\n    });\n\n    if (this.merchTargetGroups.length == 0) {\n      this.merchTargetGroups = [];\n      this.selectedGroup.SAPBranchID = sapBranchID;\n      this.selectedGroup.GroupName = '';\n      this.selectedGroup.MerchGroupID = null;\n    }\n    else if (grp.length == 0) {\n      this.selectedGroup = this.merchTargetGroups[0];\n    }\n    else {\n      this.selectedGroup = grp[0];\n    }\n\n  }\n\n  checkUserAuth(): void {\n    this.WebAPIPostCall().subscribe(res => {\n      var d: any = res;\n      if (d.UserInfo.IsValid == 1) {\n        this.localSt.store('UserGSN', d.UserInfo.GSN);\n        this.localSt.store('UserName', d.UserInfo.Name);\n        this.localSt.store('UserEmail', d.UserInfo.Email);\n        this.userName = d.UserInfo.Name;\n        if (d.Branches.length >= 0) {\n\n          var brch = d.Branches.filter((d: any) => {\n            if (d.IsDefault == true)\n              return d;\n          });\n\n          if (brch.length == 0) {\n            this.selectedBranch = d.Branches[0];\n          }\n          else {\n            this.selectedBranch = brch[0];\n          }\n          this.merchBranches = d.Branches;\n          this.nobranch = true;\n        }\n\n        if (d.Groups.length >= 0) {\n\n          this.merchGroups = d.Groups;\n          this.merchTargetGroups = Object.assign(this.merchGroups);\n\n          this.filterMerchGroups(this.selectedBranch.SAPBranchID);\n\n          this.nomerchgroup = true;\n        }\n\n        this.item = this.selectedGroup;\n        this.item.LoggedInUser = this.localSt.retrieve(\"UserGSN\");\n        this.navService.changeNav(this.item);\n\n        console.log(this.localSt.retrieve('UserGSN'));\n        console.log(this.localSt.retrieve('UserName'));\n        console.log(this.localSt.retrieve('UserEmail'));\n      }\n      else {\n        console.log(\"User GSN - \" + d.UserInfo.GSN + \" is not valid.\");\n        window.location.href = \"/InvalidUser.html?GSN=\" + d.UserInfo.GSN;\n      }\n\n    },\n      error => {\n        if (error.status == 401 || error.status == 404) {\n        }\n      });\n  }\n\n  WebAPIPostCall() {\n    // return this.http.get(this._webapi + 'api/Merc/CheckAuthentication/')\n    return this.http.get(this._webapi + 'api/Merc/CheckAuthenticationByUser/')\n      .map(response => <any>(<Response>response).json());\n  }\n  \n}\n"]}